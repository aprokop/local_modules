#%Module
conflict llvm gcc clang

set _module_name  [module-info name]
set is_module_rm  [module-info mode remove]
set sys           [uname sysname]
set os            [uname release]

set LLVM_VERSION 3.5.0
set LLVM_PATH   $env(HOME)/local/opt/llvm-$LLVM_VERSION
set GCC_PATH    $env(HOME)/local/opt/gcc-4.9.2

set-alias       clang       "clang   --gcc-toolchain=$GCC_PATH"
set-alias       clang++     "clang++ --gcc-toolchain=$GCC_PATH"

# PATH is complex because of our use of ccache and its symbolic linkage
if { [ module-info mode load ] } {
    remove-path     PATH            $env(HOME)/bin
    remove-path     PATH            $env(HOME)/local/bin
}
prepend-path    PATH            $LLVM_PATH/bin
if { [ module-info mode load ] } {
    prepend-path    PATH            $env(HOME)/local/bin
    prepend-path    PATH            $env(HOME)/bin
}
prepend-path    CPATH           $LLVM_PATH/include:$GCC_PATH/include
prepend-path    MANPATH         $LLVM_PATH/share/man
prepend-path    INFOPATH        $LLVM_PATH/share/info
prepend-path    LD_LIBRARY_PATH $LLVM_PATH/lib:$GCC_PATH/lib64

setenv          LLVM_PATH       $LLVM_PATH
setenv          LLVM_VERSION    $LLVM_VERSION

setenv          CC              clang
setenv          CFLAGS          "--gcc-toolchain=$GCC_PATH"
setenv          CXX             clang++
setenv          CXXFLAGS        "--gcc-toolchain=$GCC_PATH"
setenv          OMPI_MPICC      clang
setenv          OMPI_CFLAGS     "-fdiagnostics-color --gcc-toolchain=$GCC_PATH"
setenv          OMPI_MPICXX     clang++
setenv          OMPI_CXXFLAGS   "-fdiagnostics-color --gcc-toolchain=$GCC_PATH"
